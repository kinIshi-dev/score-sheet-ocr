# 現在のスプリント - TODO

**スプリント**: MVP開発 - スプリント1
**開始日**: 2025-12-21
**フォーカス**: コアOCR機能と基本的な前処理

---

## 優先度: 高 🔴

### 1. サンプルデータの収集
- [x] JPAスコアシート（スキャン画像）のサンプルを入手（47枚）
- [x] サンプルスコアシートを `data/raw/` に配置
- [x] `docs/scoresheet_format.md` にスコアシートのレイアウトをドキュメント化
- [x] 抽出する主要フィールドを特定（選手番号、スキル、スコアなど）

**ステータス**: 完了 ✅
**結果**: 47枚のサンプル画像取得、フォーマット完全理解

---

### 2. 画像前処理モジュール
- [x] `src/preprocessing/image_processor.py` を作成
- [x] グレースケール変換を実装
- [x] 基本的な二値化を実装（通常、適応的、Otsu）
- [x] ノイズ除去を実装（メディアン、ガウシアン、バイラテラル）
- [x] 画像リサイズ/スケーリングを実装
- [x] 前処理パイプライン関数を追加
- [ ] `tests/unit/test_preprocessing.py` にユニットテストを作成

**ステータス**: 完了 ✅（テスト以外）
**担当**: Claude + ユーザー
**実績時間**: 1時間

---

### 3. Tesseract OCR統合
- [x] `src/ocr/tesseract_ocr.py` を作成
- [x] 基本的なOCR関数を実装（画像 → テキスト）
- [x] 日本語 + 英語用にTesseractを設定
- [x] 異なるPSM（ページセグメンテーションモード）のサポート
- [x] 信頼度スコア抽出を追加
- [x] 数字専用抽出機能を追加
- [x] スコアシート専用OCRクラスを作成
- [x] 初回OCRテスト実行（信頼度34%）
- [ ] `tests/unit/test_ocr.py` にユニットテストを作成

**ステータス**: 完了 ✅（テスト以外）
**担当**: Claude + ユーザー
**実績時間**: 2時間
**次のステップ**: ROI抽出で精度向上が必要

---

### 3.5. ROI（関心領域）抽出モジュール ⚡
- [x] `src/preprocessing/roi_extractor.py` を作成
- [x] スコアシート構造の完全理解（複数回の試行錯誤）
  - 1試合 = シンメトリー構造（上ヘッダー、Player1、Player2、下ヘッダー）
  - 2人のプレイヤーが上下に配置
- [x] 太い罫線検出による試合エリア分割
  - 水平投影で黒ピクセル数を分析
  - 5試合の完璧な分離に成功
- [x] プレイヤー行抽出の実装（`extract_players_final.py`）
  - Match 0: 成功
  - Match 1-4: 要調整（各試合の高さが異なるため）
- [x] 正解データ完成（Sheet 0の全10人分）
  - player_number, player_name, skill_level, safety_count, total_score, match_score
- [x] 評価スクリプト作成（`evaluate_ocr.py`）
- [x] ROI最適化アプローチの体系的資料作成（`docs/roi_optimization_approaches.md`）
  - 6つのアプローチを詳細に比較
  - 実装例とコード付き
- [ ] **各試合内の罫線検出でプレイヤー行を正確に分離** ← 次のステップ
- [ ] 手動ROI位置特定（アプローチA）
- [ ] OCR精度測定

**ステータス**: 70%完了（プレイヤー行抽出の完成が必要）
**担当**: Claude + ユーザー
**実績時間**: 8時間
**優先度**: 🔴🔴 最高（精度向上の鍵）
**依存関係**: タスク#2、#3
**次のアクション**: 各試合エリア内の細い罫線検出によるプレイヤー分離

---

## 優先度: 中 🟡

### 4. 基本的なCLIインターフェース
- [ ] `src/cli.py` または `main.py` を作成
- [ ] 引数解析を実装（入力ファイル、出力ファイル）
- [ ] 基本的なエラーハンドリングを追加
- [ ] 単一画像処理フローを実装:
  - 画像読み込み → 前処理 → OCR → 出力
- [ ] 詳細/デバッグ出力オプションを追加
- [ ] サンプル画像でテスト

**ステータス**: 未着手
**担当**: Claude + ユーザー
**見積もり時間**: 1-2時間
**依存関係**: タスク#2と#3

---

### 5. データエクスポート機能
- [ ] `src/export/data_exporter.py` を作成
- [ ] JSONエクスポートを実装
- [ ] CSVエクスポートを実装
- [ ] 出力ファイルにタイムスタンプを追加
- [ ] 出力ディレクトリの作成を処理
- [ ] `tests/unit/test_export.py` にユニットテストを作成

**ステータス**: 未着手
**担当**: Claude + ユーザー
**見積もり時間**: 1-2時間

---

### 6. 基本的なテストセットアップ
- [ ] pytest設定を構成（`pytest.ini` または `pyproject.toml`）
- [ ] サンプル画像用のテストフィクスチャを作成
- [ ] `tests/integration/test_full_pipeline.py` に統合テストを作成
- [ ] すべてのテストが通ることを確認
- [ ] テストカバレッジレポートを追加

**ステータス**: 未着手
**担当**: Claude + ユーザー
**見積もり時間**: 1-2時間
**依存関係**: タスク#2、#3、#5

---

## 優先度: 低 🟢

### 7. ドキュメント
- [ ] `docs/scoresheet_format.md` を作成（フィールドの説明）
- [ ] `docs/development.md` を作成（コントリビューター向けセットアップ手順）
- [ ] README.mdに使用例を追加
- [ ] 前処理オプションをドキュメント化
- [ ] OCR設定オプションをドキュメント化

**ステータス**: 未着手
**担当**: ユーザー + Claude
**見積もり時間**: 1-2時間

---

### 8. 環境セットアップの検証
- [ ] クリーンな環境でインストールをテスト
- [ ] Tesseractのインストール手順を検証
- [ ] READMEにトラブルシューティングセクションを追加
- [ ] 開発依存関係用に `requirements-dev.txt` を作成

**ステータス**: 未着手
**担当**: ユーザー
**見積もり時間**: 1時間

---

## 完了 ✅

- [x] プロジェクト構造のセットアップ
- [x] `.gitignore` の作成
- [x] `requirements.txt` の作成
- [x] インストール手順付きで `README.md` を更新
- [x] プロジェクトコンテキストで `claude.md` を作成
- [x] 初期gitコミットとプッシュ
- [x] `ROADMAP.md` の作成（日本語）
- [x] `TODO.md` の作成（このファイル、日本語）
- [x] 言語方針を `claude.md` に追加
- [x] サンプルデータ収集（47枚）
- [x] `docs/scoresheet_format.md` 作成（フォーマット完全理解）
- [x] `src/preprocessing/image_processor.py` 実装
- [x] `src/ocr/tesseract_ocr.py` 実装
- [x] 環境セットアップ（venv、依存パッケージ）
- [x] `requirements.txt` 修正（opencv-headless対応）
- [x] 初回OCRテスト実行（`test_ocr.py`）

---

## ブロッカーと質問 ⚠️

1. ~~**サンプルスコアシート**~~ ✅ 解決: 47枚取得済み

2. ~~**フィールド定義**~~ ✅ 解決: `docs/scoresheet_format.md` に完全ドキュメント化

3. ~~**日本語テキストの処理**~~ ✅ 解決: Tesseract 4.1.1 + 日本語パック動作確認

4. **OCR精度が低い** (現在34%)
   - 課題: 全体画像OCRではノイズが多すぎる
   - 解決策: ROI（関心領域）抽出で特定フィールドのみ処理
   - 次のステップ: 選手番号、スキルレベルなど個別抽出

---

## 備考

- タスクは小さく集中的に保つ（各1-3時間）
- タスクが完了したら毎日このファイルを更新
- 完了したタスクを「完了」セクションに移動
- 新しいタスクが出現したら追加
- GitHub issueを作成した場合はリンク

---

## 次のスプリント計画

**スプリント2の暫定項目**:
- テンプレートベースのフィールド検出
- バッチ処理サポート
- 高度な前処理（傾き補正、パースペクティブ補正）
- データ検証ロジック
- 改善されたエラーハンドリングとロギング

---

**最終更新**: 2025-12-21 22:00
**スプリント1進捗**: 3/8タスク完了（高優先度タスク完了）
